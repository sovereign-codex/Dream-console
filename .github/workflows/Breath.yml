name: Dream Console Breath Cycle

on:
  push:
    branches: [ "main" ]
  schedule:
    # Run every hour (adjust as desired)
    - cron: "0 * * * *"
  workflow_dispatch:

jobs:
  breathe:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.10"

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt pynacl

    - name: Exhale Breath Cycle
      run: |
        python core/breath_engine.py "Automated cycle via GitHub Actions"

    - name: Sign Breath Cycle
      run: |
        # Sign the latest cycle file with Ed25519
        latest_file=$(ls -t codex/cycle_*.md | head -n1)
        python tools/self_sign.py "$latest_file"

    - name: Commit Breath Journal
      run: |
        git config --local user.email "actions@github.com"
        git config --local user.name "Dream Console Bot"
        git add codex/*.md codex/signatures/*.json || true
        git commit -m "Automated breath cycle + signature [skip ci]" || echo "No changes"
        git push
